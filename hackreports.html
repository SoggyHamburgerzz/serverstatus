<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Hacker Reports</title>
<style>
body {
  font-family: monospace;
  background: #121212;
  color: #e0e0e0;
  margin: 0;
  padding: 2em;
}

/* Main alert box */
#mainAlert {
  background: #3a0000;
  color: #ff5555;
  border: 1px solid #ff0000;
  padding: 1em;
  margin-bottom: 1.5em;
  display: none;
}

/* Table styling */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1em;
}

th, td {
  border: 1px solid #333;
  padding: 0.5em 1em;
  text-align: center;
}

th {
  background: #222;
}

tr:nth-child(even) {
  background: #1a1a1a;
}
</style>
</head>
<body>
  <h1>Hacker Reports</h1>

  <div id="mainAlert"></div>

  <table id="reportsTable">
    <thead>
      <tr><th>Server</th><th>Issue</th><th>Details</th></tr>
    </thead>
    <tbody>
      <tr><td></td><td></td><td></td></tr>
    </tbody>
  </table>

  <p id="lastUpdated" style="font-size: 0.8em; color: #aaa; margin-top: 0.5em;">
    Reports updated manually. DM @SoggyHamburgerzz on Discord for corrections.  
    <span id="editedTime"></span>
  </p>

<script>
const sheetID = '1kxRRcWFDufgGizcBwD65_EaGYceQlyAHoEkHxJP2nQI';
const reportsSheet = 'HackReports';
const lastEditedSheet = 'LastEdited'; // same sheet you used on the other page

const reportsUrl = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?sheet=${reportsSheet}&headers=1`;
const lastEditedUrl = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?sheet=${lastEditedSheet}&headers=0`;

// Fetch hacker reports
async function fetchReports() {
  try {
    const res = await fetch(reportsUrl);
    const text = await res.text();
    const jsonText = text.match(/google\.visualization\.Query\.setResponse\((.*)\)/s)[1];
    const data = JSON.parse(jsonText).table.rows;

    const tbody = document.querySelector('#reportsTable tbody');
    tbody.innerHTML = '';

    let mainShown = false;

    data.forEach((row) => {
      const server = row.c[0]?.v || '';
      const issue = row.c[1]?.v || '';
      const details = row.c[2]?.v || '';
      const mainFlag = row.c[3]?.v || ''; // "Yes" marks the main alert

      if (server || issue || details) {
        if (mainFlag.toLowerCase() === 'yes' && !mainShown) {
          const alertBox = document.getElementById('mainAlert');
          alertBox.innerHTML = `<strong>âš  Major Issue on ${server}:</strong> ${issue} - ${details}`;
          alertBox.style.display = 'block';
          mainShown = true;
        }

        tbody.innerHTML += `<tr>
          <td>${server}</td>
          <td style="color:red; font-weight:bold;">${issue}</td>
          <td>${details}</td>
        </tr>`;
      }
    });

  } catch (e) {
    console.error(e);
  }
}

// Fetch last edited timestamp
async function fetchLastEdited() {
  try {
    const res = await fetch(lastEditedUrl);
    const text = await res.text();
    const jsonText = text.match(/google\.visualization\.Query\.setResponse\((.*)\)/s)[1];
    const data = JSON.parse(jsonText).table.rows;

    const timestamp = data[0].c[0]?.f || data[0].c[0]?.v;
    document.getElementById('editedTime').textContent = ` (Last edited: ${timestamp})`;
  } catch (e) {
    console.error(e);
  }
}

fetchReports();
fetchLastEdited();
setInterval(fetchReports, 60000);
setInterval(fetchLastEdited, 60000);
</script>
</body>
</html>
